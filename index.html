<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>chamber</title>
		<script type="text/javascript" charset="utf-8" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
		<script type="text/javascript" charset="utf-8">
		$(document).ready(function(){
			$.get("/write",function(data){
				$('#write').html(data);
				$('#write #submit').click(function(){
					$(".error").hide();
					var hasError = false;
					var titleVal = $('#title').val();
					var contentVal = $('#content').val();
					var keyVal = $('#key').val();
					var passwordVal = $('#password').val();
					if(titleVal == ''){
						$('#title').after('<span class="error">title must be not null</span>');
						hasError = true;
					};
					if(contentVal == ''){
						$('#content').after('<span class="error"><br/  >content must be not null</span>');
						hasError = true;
					};
					if(!hasError){
						$.post("/write",{ title: titleVal, content: contentVal, key: keyVal, password: passwordVal },function(data){
							$("#message").html(data).show(1000);
							$.get("/list",function(data){
								$('#list').html(data);
							});
							$('#title').val('');
							$('#password').val('');
							$('#content').val('');
						});
					};
					return false;
				});
			});
			$.get("/list",function(data){
				$('#list').html(data);
			});
		});
		var edit = function(obj){
			$.get("/edit",{key:obj},function(data){
				$('#'+obj).html(data);
				//alert($('#'+obj+" :input:eq(3)").val());
				$('#'+obj+" :input:eq(4)").click(function(){
					$(".error").hide();
					var hasError = false;
					var titleId = '#'+obj+' :input:eq(1)';
					var contentId = '#'+obj+' :input:eq(3)';
					var keyId = '#'+obj+' :input:eq(0)';
					var passwordId = '#'+obj+' :input:eq(2)';
					var titleVal = $(titleId).val();
					var contentVal = $(contentId).val();
					var keyVal = $(keyId).val();
					var passwordVal = $(passwordId).val();
					if(titleVal == ''){
						$(titleId).after('<span class="error">title must be not null</span>');
						hasError = true;
					};
					if(contentVal == ''){
						$(contentId).after('<span class="error"><br/  >content must be not null</span>');
						hasError = true;
					};
					if(passwordVal == ''){
						$(passwordId).after('<span class="error"><br/  >password must be not null</span>');
						hasError = true;
					};
					
					if(!hasError){
						$.post("/edit",{ title: titleVal, content: contentVal, key: keyVal, password: passwordVal },function(data){
							$("#message").html(data).show(1000);
							$.get("/list",function(data){
								$('#list').html(data);
							});
						});
					};
					return false;
				});
			});
		};
		</script>
	</head>
	<body id="index">
		<a href="{{ url }}">{{ url_linktext }}</a>
		<div id="write"></div>
		<div id="message"></div>
		<div id="list"></div>
	</body>
</html>